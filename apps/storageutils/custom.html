<html>
<head>
  <link rel="st1ylesheet" href="../../css/spectre.min.css">
</head>

<body>
  <h1>Bangle.js RAM Test</h1>
  <button onclick="connectAndSend()">Connect and Run</button>
  <pre id="output">Waiting...</pre>

  <script src="https://www.puck-js.com/puck.js"></script>
  <script>
    async function connectAndSend() {
      try {
        const outputEl = document.getElementById("output");
        outputEl.textContent = "Connecting...";

        // Connect to Bangle.js
        await Puck.connect();
        outputEl.textContent = "Connected!\n";

        // Listen to output
        Puck.write('Bluetooth.println("Watch Ready");\n', function() {
          outputEl.textContent += "Code sent!\n";
        });

        // Handle data from watch
        let received = "";
        Puck.on('data', function(d) {
          received += d;
          outputEl.textContent += d;

          // (Optional) Handle a full line
          if (received.includes("\n")) {
            outputEl.textContent += "\n✅ Done.\n";
            Puck.close(); // Optional
          }
        });

        // Now send your custom RAM script
        // E.g., calculate 2+2 and print result
        const jsCode = `
          let result = 2+2;
          Bluetooth.println("Result: " + result);
        \n`;
        Puck.write(jsCode);

      } catch (e) {
        document.getElementById("output").textContent = "❌ Error: " + e;
      }
    }
  </script>
</body>
</html>
