<html>
<head>
  <link rel="stylesheet" href="../../css/spectre.min.css">
</head>

<body>
  <h1>Bangle.js RAdM Test</h1>
  <button class="btn btn-primary" onclick="connectAndSend()">Gather Data</button>
  <pre id="output">Waiting...</pre>

  <script src="https://www.puck-js.com/puck.js"></script>
  <script>
    let outputEl;

    async function connectAndSend() {
      outputEl.textContent = 'ðŸ”Œ Connecting to Bangle.js...';

      Puck.connect(function(conn) {
        if (!conn) {
          outputEl.textContent = 'â— Failed to connect.';
          return;
        }

        outputEl.textContent = 'âœ… Connected. Sending code...';

        conn.on('data', function(d) {
          outputEl.textContent += "\nðŸ“¡ From Bangle: " + d;
        });

        const code = `NRF.println(JSON.stringify({value:"ARRRf"}));`;
        Puck.write(`\x10EVAL\n${code}\n`);
      });
    }

    window.addEventListener("load", () => {
      outputEl = document.getElementById("output");
    });
  </script>
</body>
</html>
